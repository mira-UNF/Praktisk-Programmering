# Compiler
CXX = mcs
# Executable name
EXEC = main.exe
# C# source file
SRC = main.cs

# Data files generated by the program
DATA_TXT = data.txt
BEST_FIT = best_fit.txt
BEST_FIT_PLUS = best_fit_plus.txt
BEST_FIT_MIN = best_fit_min.txt

# Output plot file
PLOT_IMG = fit_and_data.png

# Default target: Run everything
all: $(PLOT_IMG)

# Compile the C# program
$(EXEC): $(SRC) matrix.dll
	mcs -target:exe -out:main.exe main.cs -reference:matrix.dll

# Generate the data files by running the compiled program
$(DATA_TXT) $(BEST_FIT) $(BEST_FIT_MIN): $(EXEC)
	@echo "Running main program to generate data..."
	mono $(EXEC)

# Depricated test
test:
	@echo "Generating plot..."
	graph -T png -x 0 16 -y 0 130 -X "Time [days]" -Y "Activity [arb.]" -L "Radon Decay" --bitmap-size 800x600 \
		-S 1 -m 2 $(BEST_FIT) \
		-S 1 -m 2 $(BEST_FIT_PLUS) \
		-S 4 -m 0 -I e $(DATA_TXT) \
		-S 1 -m 2 $(BEST_FIT_MIN) \
	>$@
	@echo "Plot saved as $(PLOT_IMG)"

#	graph -T png \

# Generating the plot
$(PLOT_IMG): $(DATA_TXT) $(BEST_FIT) $(BEST_FIT_PLUS)  $(BEST_FIT_MIN) Makefile
	graph -T png -x 0 16 -y 0 130 -X "Time [days]" -Y "Activity [arb.]" -L "Radon Decay" --bitmap-size 800x600 \
		-S 1 -m 1 $(BEST_FIT) \
		-S 1 -m 2 $(BEST_FIT_PLUS) \
		-S 1 -m 2 $(BEST_FIT_MIN) \
		-S 4 -m 0 -I e $(DATA_TXT) \
	> fit_and_data.png


# Compile the matrix library
matrix.dll: ../classes/matrix.cs ../classes/vector.cs ../classes/QR_GS.cs least_sq.cs
	mcs -target:library -out:matrix.dll $^

# Clean build artifacts
.PHONY: clean
clean:
	rm -f main.exe $(PLOT_IMG) $(DATA_TXT) $(BEST_FIT) matrix.dll log.png

